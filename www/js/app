// btf/www/js/app.js

document.addEventListener('deviceready', function() {
    let currentLat, currentLong, currentImageData;

    // Capture GPS coordinates
    document.getElementById('getGPS').addEventListener('click', function() {
        navigator.geolocation.getCurrentPosition(onSuccess, onError);

        function onSuccess(position) {
            alert('Latitude: ' + position.coords.latitude + '\n' +
                  'Longitude: ' + position.coords.longitude);
            currentLat = position.coords.latitude;
            currentLong = position.coords.longitude;
        }

        function onError(error) {
            alert('code: ' + error.code + '\n' +
                  'message: ' + error.message);
        }
    });

    // Capture photo
    document.getElementById('takePhoto').addEventListener('click', function() {
        navigator.camera.getPicture(onSuccess, onFail, { quality: 50, destinationType: Camera.DestinationType.DATA_URL });

        function onSuccess(imageData) {
            var image = document.getElementById('photo');
            image.src = "data:image/jpeg;base64," + imageData;
            currentImageData = imageData;
        }

        function onFail(message) {
            alert('Failed because: ' + message);
        }
    });

    // Save report locally    
    document.getElementById('saveReport').addEventListener('click', function() {
        const report = {
            gps: { lat: currentLat, long: currentLong },
            photo: currentImageData,
            timestamp: new Date().toISOString()
        };
        saveReportLocally(report);
    });

    // Save report locally
    document.getElementById('saveReport').addEventListener('click', function() {
        const report = {
            gps: { lat: currentLat, long: currentLong },
            photo: currentImageData,
            timestamp: new Date().toISOString()
        };
        saveReportLocally(report);
    });

    // Sync data when online
    document.addEventListener("online", syncData, false);
}, false);

function syncData() {
    // Implement synchronization logic to send local data to the server (MySQL backend)
}
